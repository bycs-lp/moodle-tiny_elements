{"version":3,"file":"variantslib.min.js","sources":["../src/variantslib.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Variants helper for Elements plugin.\n *\n * @module      tiny_elements/variantslib\n * @copyright   2023 Marc Catal√† <reskit@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {\n    findById,\n    findByName\n} from './helper';\n\nlet variantPreferences = {};\nlet VARIANTS = [];\nlet COMPONENTS = [];\nlet FLAVORS = [];\n\nexport const setFlavors = (flavors) => {\n    FLAVORS = flavors;\n};\n\nexport const setVariants = (variants) => {\n    VARIANTS = variants;\n};\n\nexport const setComponents = (components) => {\n    COMPONENTS = components;\n};\n\nexport const getVariantPreferences = () => {\n    return variantPreferences;\n};\n\n/**\n * Load user preferences.\n * @param {array} preferences\n * @returns {Promise}\n */\nexport const loadVariantPreferences = (preferences) => {\n    if (preferences !== undefined && preferences !== null) {\n        variantPreferences = preferences;\n    } else {\n        variantPreferences = {};\n    }\n};\n\n/**\n * Get variant preferences for a single component-flavor combination.\n * @param {*} component\n * @param {*} flavor\n * @returns\n */\nexport const getVariantPreference = (component, flavor = '') => {\n    let componentObj = findByName(COMPONENTS, component);\n    let flavorObj = findByName(FLAVORS, flavor);\n\n    if (componentObj === undefined) {\n        return [];\n    }\n\n    if (flavor == '' && !variantPreferences[componentObj.id]) {\n        return [];\n    }\n\n    if (flavor != '' && flavorObj === undefined) {\n        return [];\n    }\n\n    if (flavor != '' && !variantPreferences[componentObj.id + '-' + flavorObj.id]) {\n        return [];\n    }\n\n    if (flavor == '') {\n        return variantPreferences[componentObj.id];\n    } else {\n        return variantPreferences[componentObj.id + '-' + flavorObj.id];\n    }\n};\n\n/**\n * Returns whether a variant exists for a component.\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n * @returns {bool}\n */\nexport const variantExists = (component, variant, flavor = '') => {\n    let variantObj = findByName(VARIANTS, variant);\n    return getVariantPreference(component, flavor).indexOf(variantObj.id) !== -1;\n};\n\n/**\n * Returns each variant for a component as a CSS class.\n *\n * @param  {string} component Component name\n * @param {string} flavor Flavor name\n * @returns {Array}\n */\nexport const getVariantsClass = (component, flavor = '') => {\n    let variants = [];\n    getVariantPreference(component, flavor).forEach(variant => {\n        let variantObj = findById(VARIANTS, variant);\n        if (variantObj !== undefined) {\n            variants.push((variantObj.c4lcompatibility ? 'c4l' : 'elements') + '-' + variantObj.name + '-variant');\n        }\n    });\n\n    return variants;\n};\n\n/**\n * Return all HTML variants for a component.\n *\n * @param  {string} component Component name\n * @returns {string}\n */\nexport const getVariantsHtml = (component) => {\n    let variantsHtml = '';\n    let variantObj = {};\n\n    let componentObj = findByName(COMPONENTS, component);\n    componentObj.variants.forEach(variant => {\n        variantObj = findByName(VARIANTS, variant);\n        if (variantObj != undefined) {\n            variantsHtml += variantObj.content;\n        }\n    });\n\n    return variantsHtml;\n};\n\n/**\n * Return the HTML variant.\n *\n * @param  {string} variant Variant name\n * @returns {string}\n */\nexport const getVariantHtml = (variant) => {\n    let variantHtml = [];\n    let variantObj = {};\n\n    variantObj = findByName(VARIANTS, variant);\n    if (variantObj != undefined) {\n        variantHtml = variantObj.html;\n    }\n    return variantHtml;\n};\n\n/**\n * Add a variant to variantPreferences\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n */\nexport const addVariant = (component, variant, flavor = '') => {\n    let componentObj = findByName(COMPONENTS, component);\n    let variantObj = findByName(VARIANTS, variant);\n    let flavorObj = findByName(FLAVORS, flavor);\n\n    if (flavor == '') {\n        if (!variantPreferences[componentObj.id]) {\n            variantPreferences[componentObj.id] = [];\n        }\n        if (!variantExists(component, variant)) {\n            variantPreferences[componentObj.id].push(variantObj.id);\n        }\n    } else {\n        if (!variantPreferences[componentObj.id + '-' + flavorObj.id]) {\n            variantPreferences[componentObj.id + '-' + flavorObj.id] = [];\n        }\n        if (!variantExists(component, variant, flavor)) {\n            variantPreferences[componentObj.id + '-' + flavorObj.id].push(variantObj.id);\n        }\n    }\n};\n\n/**\n * Remove a variant from variantPreferences\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n */\nexport const removeVariant = (component, variant, flavor = '') => {\n    let componentObj = findByName(COMPONENTS, component);\n    let variantObj = findByName(VARIANTS, variant);\n    let flavorObj = findByName(FLAVORS, flavor);\n\n    if (flavor != '') {\n        let index = variantPreferences[componentObj.id + '-' + flavorObj.id].indexOf(variantObj.id);\n        if (index !== -1) {\n            delete variantPreferences[componentObj.id + '-' + flavorObj.id][index];\n        }\n        if (variantPreferences[componentObj.id + '-' + flavorObj.id].length == 0) {\n            delete variantPreferences[componentObj.id + '-' + flavorObj.id];\n        }\n    } else {\n        let index = variantPreferences[componentObj.id].indexOf(variantObj.id);\n        if (index !== -1) {\n            delete variantPreferences[componentObj.id][index];\n        }\n        if (variantPreferences[componentObj.id].length == 0) {\n            delete variantPreferences[componentObj.id];\n        }\n    }\n};\n"],"names":["variantPreferences","VARIANTS","COMPONENTS","FLAVORS","flavors","variants","components","preferences","getVariantPreference","component","flavor","componentObj","flavorObj","undefined","id","variantExists","variant","variantObj","indexOf","forEach","push","c4lcompatibility","name","variantsHtml","content","variantHtml","html","index","length"],"mappings":";;;;;;;;IA4BIA,mBAAqB,GACrBC,SAAW,GACXC,WAAa,GACbC,QAAU,uBAEaC,UACvBD,QAAUC,8BAGcC,WACxBJ,SAAWI,iCAGeC,aAC1BJ,WAAaI,2CAGoB,IAC1BN,mDAQ4BO,cAE/BP,mBADAO,MAAAA,YACqBA,YAEA,UAUhBC,qBAAuB,SAACC,eAAWC,8DAAS,GACjDC,cAAe,sBAAWT,WAAYO,WACtCG,WAAY,sBAAWT,QAASO,oBAEfG,IAAjBF,aACO,GAGG,IAAVD,QAAiBV,mBAAmBW,aAAaG,IAIvC,IAAVJ,aAA8BG,IAAdD,UACT,GAGG,IAAVF,QAAiBV,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAI5D,IAAVJ,OACOV,mBAAmBW,aAAaG,IAEhCd,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IANrD,GARA,6DA0BFC,cAAgB,SAACN,UAAWO,aAASN,8DAAS,GACnDO,YAAa,sBAAWhB,SAAUe,gBACqC,IAApER,qBAAqBC,UAAWC,QAAQQ,QAAQD,WAAWH,oEAUtC,SAACL,eAAWC,8DAAS,GAC7CL,SAAW,UACfG,qBAAqBC,UAAWC,QAAQS,SAAQH,cACxCC,YAAa,oBAAShB,SAAUe,cACjBH,IAAfI,YACAZ,SAASe,MAAMH,WAAWI,iBAAmB,MAAQ,YAAc,IAAMJ,WAAWK,KAAO,eAI5FjB,mCASqBI,gBACxBc,aAAe,GACfN,WAAa,UAEE,sBAAWf,WAAYO,WAC7BJ,SAASc,SAAQH,UAC1BC,YAAa,sBAAWhB,SAAUe,SAChBH,MAAdI,aACAM,cAAgBN,WAAWO,YAI5BD,sCASoBP,cACvBS,YAAc,GACdR,WAAa,UAEjBA,YAAa,sBAAWhB,SAAUe,SAChBH,MAAdI,aACAQ,YAAcR,WAAWS,MAEtBD,iCAUe,SAAChB,UAAWO,aAASN,8DAAS,GAChDC,cAAe,sBAAWT,WAAYO,WACtCQ,YAAa,sBAAWhB,SAAUe,SAClCJ,WAAY,sBAAWT,QAASO,QAEtB,IAAVA,QACKV,mBAAmBW,aAAaG,MACjCd,mBAAmBW,aAAaG,IAAM,IAErCC,cAAcN,UAAWO,UAC1BhB,mBAAmBW,aAAaG,IAAIM,KAAKH,WAAWH,MAGnDd,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,MACtDd,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAAM,IAE1DC,cAAcN,UAAWO,QAASN,SACnCV,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAAIM,KAAKH,WAAWH,6BAYxD,SAACL,UAAWO,aAASN,8DAAS,GACnDC,cAAe,sBAAWT,WAAYO,WACtCQ,YAAa,sBAAWhB,SAAUe,SAClCJ,WAAY,sBAAWT,QAASO,WAEtB,IAAVA,OAAc,KACViB,MAAQ3B,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAAII,QAAQD,WAAWH,KACzE,IAAXa,cACO3B,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAAIa,OAEG,GAAnE3B,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,IAAIc,eAClD5B,mBAAmBW,aAAaG,GAAK,IAAMF,UAAUE,QAE7D,KACCa,MAAQ3B,mBAAmBW,aAAaG,IAAII,QAAQD,WAAWH,KACpD,IAAXa,cACO3B,mBAAmBW,aAAaG,IAAIa,OAEG,GAA9C3B,mBAAmBW,aAAaG,IAAIc,eAC7B5B,mBAAmBW,aAAaG"}